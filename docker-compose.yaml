version: '3.8'

services:
  # LiveKit media server (voice/video)
  livekit:
    image: livekit/livekit-server:latest
    command: --config /livekit.yaml
    volumes:
      - ./livekit.yaml:/livekit.yaml
    ports:
      - "7880:7880"   # HTTP/WebSocket
      - "7881:7881"   # WebRTC
      - "50000-50200:50000-50200/udp"  # WebRTC UDP ports
    restart: unless-stopped

  # WebBridge (WebSocket â†” UDP + LiveKit token auth)
  webbridge:
    build: .
    command: ./bin/webbridge
    ports:
      - "8081:8081"
    environment:
      - LIVEKIT_URL=ws://livekit:7880
      - LIVEKIT_API_KEY=devkey
      - LIVEKIT_API_SECRET=secret123456789abcdefghij
    depends_on:
      - livekit
    restart: unless-stopped

  # Game server (UDP on :9000, spawned per-room at 9100+)
  # Note: Game servers are spawned dynamically by webbridge